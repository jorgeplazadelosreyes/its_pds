<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/konva@8.3.12/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>Estatica</title>
    <h2 style="margin_down:20; outline: black solid; text-align:center">Aca saldra un enunciado </h2>
    <style>
      body {
        margin_top: 20;
        margin_left: 20;
        padding: 0;
        overflow: hidden;
        background-color: #F5F5F5;
        background-size: cover;
        outline: black solid
      }

      #desc {
        position : absolute;
        top: 5px;
        left: 5px;
      }
    </style>
  </head>
  <body>
    <div id="container", style="width: 1500px; height: 500px;"></div>
    <script>
      var width = 1500;
      var height = 500;
      var shadowOffset = 20;
      var tween = null;
      var blockSnapSize = 30;

      var shadowRectangle = new Konva.Rect({
        x: 0,
        y: 0,
        width: blockSnapSize * 6,
        height: blockSnapSize * 3,
        fill: '#FF7B17',
        opacity: 0.6,
        stroke: '#CF6412',
        strokeWidth: 3,
        dash: [20, 2]
      });

      function newRectangle(x, y, layer, stage) {
        let rectangle = new Konva.Rect({
          x: x,
          y: y,
          width: blockSnapSize * 6,
          height: blockSnapSize * 3,
          fill: '#fff',
          stroke: '#ddd',
          strokeWidth: 1,
          shadowColor: 'black',
          shadowBlur: 2,
          shadowOffset: {x : 1, y : 1},
          shadowOpacity: 0.4,
          draggable: true
        });
        rectangle.on('dragstart', (e) => {
          shadowRectangle.show();
          shadowRectangle.moveToTop();
          rectangle.moveToTop();
        });
        rectangle.on('dragend', (e) => {
          rectangle.position({
            x: Math.round(rectangle.x() / blockSnapSize) * blockSnapSize,
            y: Math.round(rectangle.y() / blockSnapSize) * blockSnapSize
          });
          stage.batchDraw();
          shadowRectangle.hide();
        });
        rectangle.on('dragmove', (e) => {
          shadowRectangle.position({
            x: Math.round(rectangle.x() / blockSnapSize) * blockSnapSize,
            y: Math.round(rectangle.y() / blockSnapSize) * blockSnapSize
          });
          stage.batchDraw();
        });
        layer.add(rectangle);
      }

      function toolRectangle(layer, stage) {
        let rectangle = new Konva.Rect({
          x: 1400,
          y: 10,
          width: blockSnapSize * 2,
          height: blockSnapSize * 1,
          fill: '#fff',
          stroke: '#ddd',
          strokeWidth: 1,
          shadowColor: 'black',
          shadowBlur: 2,
          shadowOffset: {x : 1, y : 1},
          shadowOpacity: 0.4,
          draggable: false,
        });
        rectangle.on('pointerdown', function () {
          newRectangle(blockSnapSize * 17, blockSnapSize * 3, layer, stage);
        });
        
        layer.add(rectangle);
      }

      var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
      });

      var gridLayer = new Konva.Layer();
      var padding = blockSnapSize;
      console.log(width, padding, width / padding);
      for (var i = 0; i < width / padding; i++) {
        gridLayer.add(new Konva.Line({
          points: [Math.round(i * padding) + 0.5, 0, Math.round(i * padding) + 0.5, height],
          stroke: '#ddd',
          strokeWidth: 1,
        }));
      }

      gridLayer.add(new Konva.Line({points: [0,0,10,10]}));
      for (var j = 0; j < height / padding; j++) {
        gridLayer.add(new Konva.Line({
          points: [0, Math.round(j * padding), width, Math.round(j * padding)],
          stroke: '#ddd',
          strokeWidth: 0.5,
        }));
      }

      var layer = new Konva.Layer();
      shadowRectangle.hide();
      layer.add(shadowRectangle);
      newRectangle(blockSnapSize * 3, blockSnapSize * 3, layer, stage);
      newRectangle(blockSnapSize * 10, blockSnapSize * 3, layer, stage);
      toolRectangle( layer, stage)

      stage.add(gridLayer);
      stage.add(layer);

    </script>
  </body>
</html>