<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/konva@8.3.12/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>Estatica</title>
    <h2 style="margin_down:20; outline: black solid; text-align:center">Aca saldra un enunciado </h2>
    <style>
      body {
        margin_top: 20;
        margin_left: 20;
        overflow: hidden;
        background-color: #f0f0f0;
        outline: black solid
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script>
      var alto = 600
      var largo = 1500
        const stage = new Konva.Stage({
            container: 'container',
            width: largo,
            height: alto
          });
          
          const layer = new Konva.Layer();
          
          {% comment %} var cir = new Konva.Circle({
            radius: 2,
            fill: 'grey',
            name: 'node'
          }); {% endcomment %}
          
          var padding = 30;
          for (var i = 0; i < largo / padding; i++) {
            layer.add(new Konva.Line({
              points: [Math.round(i * padding) + 0.5, 0, Math.round(i * padding) + 0.5, alto],
              stroke: '#000000',
              strokeWidth: 1,
            }));
            
          }
          layer.add(new Konva.Line({points: [0,0,10,10]}));
          
          for (var j = 0; j < largo / padding; j++) {
            layer.add(new Konva.Line({
              points: [0, Math.round(j * padding), largo, Math.round(j * padding)],
              stroke: '#000000',
              strokeWidth: 0.5,
            }));
          }
          
          for(var j = 30; j < alto; j+=30){
            for(var i = 30; i < largo; i+=30){

              var cir = new Konva.Circle({
                x: i,
                y: j,
                radius: 4,
                fill: 'grey',
                name: 'node'
              });

              layer.add(cir);
              }
          }
          
          
         
          
          
          
          
          
          let drawingLine = false;
          let line;
          stage.on('mousedown', (e) => {
            if (e.target.hasName('node')) {
              drawingLine = true;
              const pos = stage.getPointerPosition();
              line = new Konva.Line({
                stroke: 'black',
                strokeWidth: 7,
                // remove line from hit graph, so we can check intersections
                listening: false,
                points: [e.target.x(), e.target.y(), pos.x, pos.y]
              });
              layer.add(line);
            }
          });
          
          stage.on('mouseover', (e) => {
            if (e.target.hasName('node')) {
              e.target.stroke('black');
              layer.draw();
            }
          });
          
          stage.on('mouseout', (e) => {
            if (e.target.hasName('node')) {
              e.target.stroke(null);
              layer.draw();
            }
          });
          
          stage.on('mousemove', (e) => {
            if (!line) {
              return;
            }
            const pos = stage.getPointerPosition();
            const points = line.points().slice();
            points[2] = pos.x;
            points[3] = pos.y;
            line.points(points);
            layer.batchDraw();
          });
          
          stage.on('mouseup', (e) => {
            if (!line) {
              return;
            }
            if (!e.target.hasName('node')) {
              line.destroy();
              layer.draw();
              line = null;
            } else {
              let pos = e.target.getClientRect();
              const points = line.points().slice();
              points[2] = pos.x + (e.target.width()/2);
              points[3] = pos.y + (e.target.height()/2);;
              line.points(points);
              layer.batchDraw();
              line = null;
            }
            
          });
          
          stage.add(layer);
          layer.draw();
    </script>
  </body>
</html>